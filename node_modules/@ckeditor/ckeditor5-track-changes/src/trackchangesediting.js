/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x5c9f50 from'@ckeditor/ckeditor5-core/src/plugin';import ft from'@ckeditor/ckeditor5-core/src/pendingactions';import lt from'@ckeditor/ckeditor5-collaboration-core/src/users';import kt from'@ckeditor/ckeditor5-engine/src/model/range';import _0x18210e from'@ckeditor/ckeditor5-engine/src/model/liverange';import yt from'@ckeditor/ckeditor5-engine/src/model/documentselection';import wt from'@ckeditor/ckeditor5-engine/src/model/treewalker';import _0x3a7c90 from'@ckeditor/ckeditor5-utils/src/ckeditorerror';import St from'@ckeditor/ckeditor5-comments/src/comments/commentsrepository';import _0x326728 from'./commands/trackchangescommand';import _0x34715e from'./commands/acceptsuggestioncommand';import _0x2e00b0 from'./commands/discardsuggestioncommand';import _0x4e666e from'./commands/acceptallsuggestionscommand';import _0xa99284 from'./commands/acceptselectedsuggestionscommand';import _0x1858d2 from'./commands/discardallsuggestionscommand';import _0x9b1287 from'./commands/discardselectedsuggestionscommand';import ot from'./suggestion';import _0xcc1aed from'./suggestiondescriptionfactory';import ht from'@ckeditor/ckeditor5-utils/src/uid';import It from'@ckeditor/ckeditor5-utils/src/emittermixin';import nt from'@ckeditor/ckeditor5-utils/src/mix';import'../theme/suggestion.css';import'../theme/suggestionmarker.css';import _0xccf6b8 from'./integrations/inputcommand';import _0x445a8c from'./integrations/deletecommand';import _0x48934e from'./integrations/entercommand';import _0x7a0dbf from'./integrations/shiftentercommand';import it from'./integrations/undo';import _0x5ce055 from'./integrations/comments';import _0x269171 from'./integrations/image';import _0x1a0e05 from'./integrations/horizontalline';import _0x758e51 from'./integrations/table';import _0x134746 from'./integrations/mediaembed';import _0x1f7aad from'./integrations/basicstyles';import _0x1e670b from'./integrations/heading';import et from'./integrations/title';import _0x364ac7 from'./integrations/link';import _0x9a2703 from'./integrations/pagebreak';import _0x33488a from'./integrations/paragraph';import _0x3e1e14 from'./integrations/blockquote';import _0x525e8f from'./integrations/list';import _0x1ba4fc from'./integrations/font';import _0x1f8999 from'./integrations/removeformat';import _0x2328ac from'./integrations/alignment';import _0x2794a9 from'./integrations/highlight';import _0x3548fe from'./integrations/mention';import _0x71c747 from'./integrations/indent';import _0x126a99 from'./integrations/codeblock';import tt from'./integrations/standardeditingmode';import _0x12408f from'./integrations/restrictededitingmode';import _0x23b4b7 from'./integrations/selectall';import bt from'./utils/hashobject.js';export default class gt extends _0x5c9f50{static get['requires'](){return[lt,ft,St,_0xccf6b8,_0x445a8c,_0x48934e,_0x7a0dbf,it,_0x5ce055,_0x269171,_0x1a0e05,_0x758e51,_0x134746,_0x1f7aad,_0x1e670b,et,_0x364ac7,_0x9a2703,_0x33488a,_0x3e1e14,_0x525e8f,_0x1ba4fc,_0x1f8999,_0x2328ac,_0x2794a9,_0x3548fe,_0x71c747,_0x126a99,tt,_0x12408f,_0x23b4b7];}static get['pluginName'](){return'TrackChangesEditing';}constructor(_0xcc12d7){function _0x3c6eab(_0x3b899a){return _0x3b899a['map'](_0x3ebc26=>String['fromCharCode'](_0x3ebc26))['join']('');}super(_0xcc12d7),this['set']('activeMarkers',[]),this['on']('change:activeMarkers',(_0x47803b,_0x569778,_0x31b7a8,_0x27d7e8)=>{this['_model']['change'](_0x1129cf=>{for(const _0x24b230 of[..._0x27d7e8,..._0x31b7a8])this['_model']['markers']['has'](_0x24b230)&&_0x1129cf['updateMarker'](_0x24b230);});}),this['D']=null,this['_descriptionFactory']=new _0xcc1aed(this['editor']['model']['schema'],this['editor']['locale']),this['_suggestionFactory']=new vt(this['editor']),this['_suggestions']=new Map(),this['_']=_0xcc12d7['plugins']['get'](St),this['h']=new Set(),this['_model']=this['editor']['model'],this['B']=new WeakMap(),this[_0x3c6eab([0x5f,0x65,0x78,0x65,0x63,0x75,0x74,0x65,0x53,0x75,0x67,0x67,0x65,0x73,0x74,0x69,0x6f,0x6e])]=_0x3c6eab([0x34,0x30,0x34,0x30,0x31,0x30,0x35,0x34]);}['init'](){const _0x56f50c=this['editor'];_0x56f50c['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion','view':_0x2567ce=>{const {id:_0x263d8a,type:_0x1e71d8}=this['_splitMarkerName'](_0x2567ce['markerName']),_0x5140b3=['ck-suggestion-marker','ck-suggestion-marker-'+_0x1e71d8];return this['activeMarkers']['includes'](_0x2567ce['markerName'])&&_0x5140b3['push']('ck-suggestion-marker--active'),{'classes':_0x5140b3,'attributes':{'data-suggestion':_0x263d8a},'priority':0xbb8};}}),_0x56f50c['conversion']['for']('dataDowncast')['markerToElement']({'model':'suggestion','view':(_0x51e908,_0x340cf4)=>{const {id:_0x5e6bf2,type:_0x226425,subType:_0x562fe4,authorId:_0x46273e,markerCount:_0x13bcc3}=this['_splitMarkerName'](_0x51e908['markerName']);return _0x340cf4['createUIElement']('suggestion',{'id':_0x5e6bf2+':'+_0x46273e,'suggestion-type':_0x562fe4?_0x226425+':'+_0x562fe4:_0x226425,'type':_0x51e908['isOpening']?'start':'end','marker-count':_0x13bcc3});}}),_0x56f50c['conversion']['for']('upcast')['elementToMarker']({'view':{'name':'suggestion','attribute':{'id':/^\w/,'suggestionType':/^\w/}},'model':_0x3bcae8=>{let _0x3869ed='suggestion:'+_0x3bcae8['getAttribute']('suggestion-type')+':'+_0x3bcae8['getAttribute']('id');return _0x3bcae8['getAttribute']('marker-count')&&(_0x3869ed+=':'+_0x3bcae8['getAttribute']('marker-count')),_0x3869ed;}}),_0x56f50c['conversion']['for']('editingDowncast')['add'](_0x5bfa30=>{_0x5bfa30['on']('addMarker:suggestion:formatBlock',(_0x19ab5e,_0x5d6f17,_0x3d29a9)=>{if(_0x3d29a9['consumable']['consume'](_0x5d6f17['item'],_0x19ab5e['name']))return;if(!_0x3d29a9['consumable']['consume'](_0x5d6f17['markerRange'],_0x19ab5e['name']))return;const _0x334348=_0x5d6f17['markerRange']['getWalker'](),_0x19f7e6=_0x56f50c['model']['schema'];for(const _0xab68b7 of _0x334348){const _0x389270=_0xab68b7['item'],{id:_0x970b55}=this['_splitMarkerName'](_0x5d6f17['markerName']);if(_0x389270['is']('element')&&_0x19f7e6['isBlock'](_0x389270)){const _0x26c7ea=_0x3d29a9['mapper']['toViewElement'](_0x389270);_0x3d29a9['writer']['addClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock'],_0x26c7ea),_0x3d29a9['writer']['setAttribute']('data-suggestion',_0x970b55,_0x26c7ea),_0x3d29a9['mapper']['bindElementToMarker'](_0x26c7ea,_0x5d6f17['markerName']),this['activeMarkers']['includes'](_0x5d6f17['markerName'])?_0x3d29a9['writer']['addClass']('ck-suggestion-marker--active',_0x26c7ea):_0x3d29a9['writer']['removeClass']('ck-suggestion-marker--active',_0x26c7ea);}'elementStart'==_0xab68b7['type']&&_0x19f7e6['isObject'](_0x389270)&&_0x334348['skip'](_0x7aae0e=>!('elementEnd'==_0x7aae0e['type']&&_0x7aae0e['item']==_0x389270));}},{'priority':'high'}),_0x5bfa30['on']('removeMarker:suggestion:formatBlock',(_0x142394,_0x43d772,_0x143072)=>{const _0x21c9e5=_0x143072['mapper']['markerNameToElements'](_0x43d772['markerName']);if(_0x21c9e5)for(const _0x17de96 of _0x21c9e5)_0x143072['writer']['removeClass']('ck-suggestion-marker-formatBlock',_0x17de96),_0x143072['writer']['removeClass']('ck-suggestion-marker--active',_0x17de96),_0x143072['writer']['removeAttribute']('data-suggestion',_0x17de96),_0x143072['mapper']['unbindElementFromMarkerName'](_0x17de96,_0x43d772['markerName']);},{'priority':'high'});}),_0x56f50c['model']['document']['registerPostFixer'](_0x2ae51a=>{let _0x5b4715=!0x1;const _0x1ddded=Array['from'](_0x56f50c['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x5f0456,data:_0x5f1aeb}of _0x1ddded){const {group:_0x301d0b,type:_0x31d1d0,id:_0x5a1832}=this['_splitMarkerName'](_0x5f0456);if('suggestion'!==_0x301d0b)continue;const _0x4f23c3=this['_suggestions']['get'](_0x5a1832);if(null!=_0x5f1aeb['newRange']){'formatInline'==_0x31d1d0&&(_0x5b4715=_0x5b4715||Ct(_0x5f1aeb['newRange'],_0x5f0456,_0x2ae51a,_0x56f50c['model']['schema']));if(_0x5f1aeb['newRange']['isCollapsed']||'$graveyard'==_0x5f1aeb['newRange']['root']['rootName']||'formatBlock'==_0x31d1d0&&!At(_0x5f1aeb['newRange']))_0x2ae51a['removeMarker'](_0x5f0456),_0x5b4715=!0x0;else{if(!_0x4f23c3||!_0x4f23c3['isInContent'])continue;_0x5b4715=!!this['j'](_0x4f23c3)||_0x5b4715;}}}return _0x5b4715;}),_0x56f50c['model']['document']['registerPostFixer'](_0x252221=>{let _0x1893e4=!0x1;for(const _0x216ef2 of _0x56f50c['model']['document']['differ']['getChanges']()){if('insert'!=_0x216ef2['type'])continue;const _0x71f3e9=_0x216ef2['position']['getShiftedBy'](_0x216ef2['length']);if(_0x71f3e9['isAtEnd'])for(const _0x4d0a78 of this['_suggestions']['values']()){if(_0x4d0a78['isMultiRange']||!_0x4d0a78['isInContent'])continue;if('formatBlock'!=_0x4d0a78['type'])continue;const _0x5eb432=_0x4d0a78['getFirstRange']();if(_0x5eb432['start']['parent']!=_0x5eb432['end']['parent']&&_0x5eb432['end']['isEqual'](_0x216ef2['position'])){const _0x13631b=_0x56f50c['model']['createRange'](_0x5eb432['start'],_0x71f3e9);_0x252221['updateMarker'](_0x4d0a78['getFirstMarker'](),{'range':_0x13631b}),_0x1893e4=!0x0;}}}return _0x1893e4;}),_0x56f50c['model']['markers']['on']('update:suggestion',(_0x2ce096,_0x38e72e,_0x28a70a)=>{if(null==_0x28a70a){const {id:_0x5c90cf}=this['_splitMarkerName'](_0x38e72e['name']),_0x5def94=this['_suggestions']['get'](_0x5c90cf);_0x5def94&&_0x5def94['addMarkerName'](_0x38e72e['name']);}}),_0x56f50c['model']['document']['on']('change:data',()=>{const _0x456809=Array['from'](_0x56f50c['model']['document']['differ']['getChangedMarkers']());_0x456809['sort']((_0xb5e6db,_0x4ede17)=>{const _0x811bfa=_0xb5e6db['data']['oldRange'],_0x3e7a83=_0x4ede17['data']['oldRange'];return null===_0x811bfa&&null===_0x3e7a83?0x0:null===_0x811bfa&&null!==_0x3e7a83?-0x1:null!==_0x811bfa&&null===_0x3e7a83?0x1:_0x811bfa['start']['isBefore'](_0x3e7a83['start'])?-0x1:0x1;});for(const {name:_0x5cd12a,data:_0x5025fa}of _0x456809){const {group:_0x308778,id:_0x2aecf5}=this['_splitMarkerName'](_0x5cd12a);if('suggestion'===_0x308778&&(null===_0x5025fa['oldRange']&&this['M'](_0x5cd12a),null===_0x5025fa['newRange'])){const _0x3030c2=this['_suggestions']['get'](_0x2aecf5);_0x3030c2['isInContent']||this['U'](_0x3030c2);}}const _0xaf55f3=new Set();for(const {name:_0x5cc84a,data:_0xf4f09d}of _0x456809){const {group:_0x256e06,id:_0x16e6c8}=this['_splitMarkerName'](_0x5cc84a);if('suggestion'!==_0x256e06)continue;const _0x65de80=this['_suggestions']['get'](_0x16e6c8);null!=_0xf4f09d['newRange']&&null!=_0xf4f09d['oldRange']&&(this['N'](_0x65de80),_0xaf55f3['add'](_0x65de80['head']));}for(const _0x134345 of _0xaf55f3)this['fire']('suggestionChanged',_0x134345);_0xaf55f3['clear']();}),_0x56f50c['model']['on']('applyOperation',(_0x402dcf,_0x4d328e)=>{const _0x3394fd=_0x4d328e[0x0];if(!this['_suggestions']['size'])return;if(!_0x3394fd['isDocumentOperation'])return;if('transparent'==_0x3394fd['batch']['type'])return;let _0xa5a554,_0x2cea3a;switch(_0x3394fd['type']){case'insert':_0xa5a554=_0x56f50c['model']['createPositionAt'](_0x3394fd['position']),_0x2cea3a=_0xa5a554['getShiftedBy'](_0x3394fd['howMany']);break;case'split':_0xa5a554=_0x56f50c['model']['createPositionAt'](_0x3394fd['splitPosition']),_0x2cea3a=_0x56f50c['model']['createPositionAt'](_0x3394fd['moveTargetPosition']);break;case'move':_0xa5a554=_0x56f50c['model']['createPositionAt'](_0x3394fd['targetPosition']),_0x2cea3a=_0xa5a554['getShiftedBy'](_0x3394fd['howMany']);break;default:return;}const _0x46880e=_0x56f50c['model']['createRange'](_0xa5a554,_0x2cea3a);_0x56f50c['model']['change'](()=>{for(const {suggestion:_0x2f3dc8,meta:_0x16811b}of this['R'](_0x46880e)){if(_0x2f3dc8['isMultiRange'])continue;if('formatInline'==_0x2f3dc8['type'])continue;const _0x665135=_0x2f3dc8['data']&&_0x2f3dc8['data']['multipleBlocks'];('formatBlock'!=_0x2f3dc8['type']||'split'==_0x3394fd['type']&&!_0x665135)&&(_0x16811b['containsRangeInObject']||'insertion'==_0x2f3dc8['type']&&_0x16811b['isOwn']||_0x2f3dc8['getFirstRange']()['containsRange'](_0x46880e)&&this['O'](_0x2f3dc8,_0xa5a554,_0x2cea3a));}});},{'priority':'lowest'}),_0x56f50c['model']['on']('deleteContent',(_0x24c6d6,_0x59c353)=>{const _0x2f2580=_0x59c353[0x0],_0x2b93a5=_0x59c353[0x1];if(_0x2b93a5&&_0x2b93a5['forceDefaultExecution'])return;if(!this['trackChangesCommand']['value'])return;if(_0x2f2580['isCollapsed'])return;const _0x170cf9=_0x2f2580['getFirstRange']();_0x56f50c['model']['change'](_0x3cdc58=>{this['markDeletion'](_0x170cf9);const _0x295f0a=_0x56f50c['model']['schema']['getNearestSelectionRange'](_0x170cf9['start']);_0x2f2580 instanceof yt?_0x3cdc58['setSelection'](_0x295f0a):_0x2f2580['setTo'](_0x295f0a);}),_0x24c6d6['stop']();},{'priority':'high'}),_0x56f50c['model']['on']('insertContent',(_0xa9c0f8,_0x30f275)=>{const _0x53bf75=_0x30f275[_0x30f275['length']-0x1];_0x53bf75&&_0x53bf75['forceDefaultExecution']||this['trackChangesCommand']['value']&&(_0x56f50c['model']['change'](()=>{let _0x5646e9=_0x56f50c['model']['insertContent'](_0x30f275[0x0],_0x30f275[0x1],_0x30f275[0x2],_0x30f275[0x3],{'forceDefaultExecution':!0x0});if(!_0x5646e9)return;_0xa9c0f8['return']=_0x5646e9['clone']();const _0x13fe96=_0x5646e9['end']['nodeBefore'],_0x39ed8a=_0x56f50c['model']['schema'];_0x13fe96&&_0x39ed8a['isBlock'](_0x13fe96)&&!_0x39ed8a['isObject'](_0x13fe96)&&(_0x5646e9=_0x56f50c['model']['createRange'](_0x5646e9['start'],_0x56f50c['model']['createPositionAt'](_0x13fe96,'end'))),this['markInsertion'](_0x5646e9);}),_0xa9c0f8['stop']());},{'priority':'high'}),this['trackChangesCommand']=new _0x326728(_0x56f50c,this['h']),this['editor']['commands']['add']('trackChanges',this['trackChangesCommand']),this['enableCommand']('trackChanges');const _0x3fd49f=new _0x34715e(_0x56f50c,this['_suggestions']);_0x56f50c['commands']['add']('acceptSuggestion',_0x3fd49f),this['enableCommand']('acceptSuggestion');const _0x4428d7=new _0x2e00b0(_0x56f50c,this['_suggestions']);_0x56f50c['commands']['add']('discardSuggestion',_0x4428d7),this['enableCommand']('discardSuggestion'),_0x56f50c['commands']['add']('acceptAllSuggestions',new _0x4e666e(_0x56f50c,_0x3fd49f,this['_suggestions'])),this['enableCommand']('acceptAllSuggestions'),_0x56f50c['commands']['add']('discardAllSuggestions',new _0x1858d2(_0x56f50c,_0x4428d7,this['_suggestions'])),this['enableCommand']('discardAllSuggestions'),_0x56f50c['commands']['add']('acceptSelectedSuggestions',new _0xa99284(_0x56f50c,_0x3fd49f,this['_suggestions'])),this['enableCommand']('acceptSelectedSuggestions'),_0x56f50c['commands']['add']('discardSelectedSuggestions',new _0x9b1287(_0x56f50c,_0x4428d7,this['_suggestions'])),this['enableCommand']('discardSelectedSuggestions');const _0xc9e817=_0x56f50c['plugins']['get'](St);this['listenTo'](_0xc9e817,'addComment',(_0x270480,{threadId:_0x204077})=>{const _0x3d764b=this['_suggestions']['get'](_0x204077);_0x3d764b&&_0x3d764b['commentThread']&&0x1===_0x3d764b['commentThread']['length']&&this['P'](_0x204077,{'hasComments':!0x0});},{'priority':'low'}),this['listenTo'](_0xc9e817,'removeComment',(_0x269aca,{threadId:_0x414f09})=>{const _0xcc792b=this['_suggestions']['get'](_0x414f09);_0xcc792b&&_0xcc792b['commentThread']&&!_0xcc792b['commentThread']['length']&&this['P'](_0x414f09,{'hasComments':!0x1});},{'priority':'low'});}set['adapter'](_0x1c6c8e){if(this['D'])throw new _0x3a7c90('track-changes-adapter-already-set:\x20Cannot\x20set\x20an\x20adapter\x20more\x20than\x20once.',this);this['D']=_0x1c6c8e;}get['adapter'](){return this['D'];}['getSuggestions'](){return Array['from'](this['_suggestions']['values']());}['getSuggestion'](_0x473aa1){const _0x5c784e=this['_suggestions']['get'](_0x473aa1);if(!_0x5c784e)throw new _0x3a7c90('track-changes-suggestion-not-found:\x20Suggestion\x20with\x20given\x20id\x20not\x20found.',this);return _0x5c784e;}['hasSuggestion'](_0x54136c){return this['_suggestions']['has'](_0x54136c);}['addSuggestionData'](_0xc03c3b){const {id:_0xcadc1,authorId:_0x3f3bd5}=_0xc03c3b,[_0x462200,_0x2cac41]=_0xc03c3b['type']['split'](':'),_0x3a88fb=this['_suggestions']['get'](_0xcadc1)||this['G'](_0x462200,_0x2cac41,_0xcadc1,_0x3f3bd5);switch(this['F'](_0x3a88fb),this['L'](_0x3a88fb,_0x462200,_0x2cac41||null,_0x3f3bd5),_0x3a88fb['createdAt']=_0xc03c3b['createdAt'],_0xc03c3b['data']&&(_0x3a88fb['data']=_0xc03c3b['data']),this['B']['get'](_0x3a88fb)){case'notReady':this['B']['set'](_0x3a88fb,'dataReady');break;case'markerReady':_0x3a88fb['isInContent']?(this['B']['set'](_0x3a88fb,'ready'),this['fire']('suggestionLoaded',_0x3a88fb)):this['B']['set'](_0x3a88fb,'removed');}return _0x3a88fb;}['enableCommand'](_0x50d026,_0x38fd9c){const _0x57257f=this['editor']['commands']['get'](_0x50d026);if(!_0x57257f)throw new _0x3a7c90('track-changes-command-not-found:\x20Trying\x20to\x20enable\x20command\x20that\x20does\x20not\x20exist.',this);this['h']['add'](_0x57257f),_0x38fd9c&&_0x57257f['on']('execute',(_0x224631,_0x4f3642)=>{this['trackChangesCommand']['value']&&(_0x4f3642['length']>0x0&&_0x4f3642[_0x4f3642['length']-0x1]&&_0x4f3642[_0x4f3642['length']-0x1]['forceDefaultExecution']||(_0x38fd9c((..._0x4a1686)=>_0x57257f['execute'](..._0x4a1686,{'forceDefaultExecution':!0x0}),..._0x4f3642),_0x224631['stop']()));},{'priority':'high'});}['markInsertion'](_0x34931d,_0x397ad3=null){if(_0x34931d['isCollapsed'])return null;const _0x4bb496=this['editor']['plugins']['get']('Users')['me'];for(const {suggestion:_0xb30bdb,meta:_0x132dac}of this['R'](_0x34931d,'insertion'))if(_0x132dac['isOwn']){if(_0x132dac['isNextTo']&&_0x397ad3==_0xb30bdb['subType']){const _0x26d739=_0xb30bdb['getFirstRange']();_0x26d739['start']['isEqual'](_0x34931d['end'])?this['q'](_0xb30bdb,this['_model']['createRange'](_0x34931d['start'],_0x26d739['end'])):this['q'](_0xb30bdb,this['_model']['createRange'](_0x26d739['start'],_0x34931d['end']));}return _0xb30bdb;}const _0x7f272d=ht(),_0x3e4388=_0x4bb496['id'],_0x1cbcfa=_0x397ad3?'insertion:'+_0x397ad3:'insertion',_0x4c487b=this['W']({'id':_0x7f272d,'type':_0x1cbcfa,'createdAt':new Date(),'authorId':_0x3e4388});return this['H'](_0x1cbcfa,_0x7f272d,_0x3e4388,_0x34931d),_0x4c487b;}['markMultiRangeInsertion'](_0x8e68a4,_0x2d330d='multi'){const _0x1fd52c=this['editor']['plugins']['get']('Users')['me'],_0x13a07f=this['_suggestionFactory']['getSuggestionCallback']('insertion',_0x2d330d,'join');for(const _0xbd5052 of this['getSuggestions']())if(_0xbd5052['author']['id']==_0x1fd52c['id']&&'insertion'==_0xbd5052['type']&&_0xbd5052['subType']==_0x2d330d&&(_0x13a07f(_0xbd5052['getRanges'](),_0x8e68a4)||_0x13a07f(_0x8e68a4,_0xbd5052['getRanges']()))){for(const _0x27a29c of _0x8e68a4)_0xbd5052['addRange'](_0x27a29c);return _0xbd5052;}for(const _0x1f216d of _0x8e68a4)for(const {suggestion:_0x34742d,meta:_0x432057}of this['R'](_0x1f216d,'insertion')){if(!_0x432057['isOwn'])continue;let _0x3b4321=!0x0;for(const _0x2dff16 of _0x34742d['getRanges']())for(const _0x3160fc of _0x8e68a4)if(!_0x2dff16['containsRange'](_0x3160fc)){_0x3b4321=!0x1;break;}if(_0x3b4321)return _0x34742d;}const _0x4894ce=ht(),_0x5863ac=_0x1fd52c['id'],_0x259bec='insertion:'+_0x2d330d,_0xeca52d=this['W']({'id':_0x4894ce,'type':_0x259bec,'createdAt':new Date(),'authorId':_0x5863ac});for(const _0x2967f5 of _0x8e68a4)this['H'](_0x259bec,_0x4894ce,_0x5863ac,_0x2967f5,ot['getMultiRangeId']());return _0xeca52d;}['markInlineFormat'](_0x3ad1c8,_0x44eef1,_0x1fd141=null){if(_0x1fd141=_0x1fd141||_t(_0x44eef1),_0x3ad1c8['isCollapsed'])return;const _0x3fe6af=this['editor']['plugins']['get']('Users')['me'],_0x473460=[];for(const {suggestion:_0x9970b7,meta:_0x11593c}of this['R'](_0x3ad1c8,'insertion'))!_0x11593c['isOwn']||_0x11593c['isNextTo']||_0x11593c['isInsideObject']||_0x473460['push'](..._0x9970b7['getRanges']());const _0x5372ad=function(_0x469adc,_0x5b88a0){const _0x46310d=[];for(const _0xf89681 of _0x5b88a0){const _0x2ba0aa=_0x469adc['getIntersection'](_0xf89681);_0x46310d['push'](_0x2ba0aa);}return _0x46310d;}(_0x3ad1c8,_0x473460),_0x2d1326=function(_0x504f3f,_0x19d45d){const _0x573463=[_0x504f3f];for(const _0x5ba3a3 of _0x19d45d){let _0x1191da=0x0;for(;_0x1191da<_0x573463['length'];){const _0x15a259=_0x573463[_0x1191da]['getDifference'](_0x5ba3a3);_0x573463['splice'](_0x1191da,0x1,..._0x15a259),_0x1191da+=_0x15a259['length'];}}return _0x573463;}(_0x3ad1c8,_0x473460);_0x5372ad['length']&&this['_model']['change'](()=>{for(const _0x3babe3 of _0x5372ad){this['_suggestionFactory']['getSuggestionCallback']('formatInline',_0x1fd141,'accept')([_0x3babe3],_0x44eef1);}});for(const _0x2ef41a of _0x2d1326){let _0x239326=null,_0x3b8a13=_0x2ef41a['start'],_0x2f3a93=_0x2ef41a['end'];for(const {suggestion:_0x4fe70f,meta:_0x515f6b}of this['R'](_0x2ef41a,'formatInline')){if(!_0x515f6b['isOwn'])continue;if(_0x4fe70f['subType']!=_0x1fd141)continue;const _0x594011=_0x4fe70f['getFirstRange']();if(_0x594011['containsRange'](_0x2ef41a,!0x0))return;_0x3b8a13=_0x3b8a13['isBefore'](_0x594011['start'])?_0x3b8a13:_0x594011['start'],_0x2f3a93=_0x2f3a93['isAfter'](_0x594011['end'])?_0x2f3a93:_0x594011['end'],_0x239326?_0x594011['start']['isBefore'](_0x239326['getFirstRange']()['start'])?(_0x239326['removeMarkers'](),_0x239326=_0x4fe70f):_0x4fe70f['removeMarkers']():_0x239326=_0x4fe70f;}const _0x4a5cf0=this['_model']['createRange'](_0x3b8a13,_0x2f3a93);if(_0x239326)this['q'](_0x239326,_0x4a5cf0);else{const _0x1bbad3=ht(),_0x1b5a27=_0x3fe6af['id'];this['W']({'id':_0x1bbad3,'type':'formatInline:'+_0x1fd141,'data':_0x44eef1,'createdAt':new Date(),'authorId':_0x1b5a27}),this['H']('formatInline:'+_0x1fd141,_0x1bbad3,_0x1b5a27,_0x4a5cf0);}}}['markBlockFormat'](_0x2beb1c,_0x23b090,_0x2b1af9=[],_0x42ffbe=null){_0x23b090['formatGroupId']||(_0x23b090['formatGroupId']=_0x23b090['commandName']),_0x23b090['multipleBlocks']=_0x2beb1c instanceof kt,_0x42ffbe=_0x42ffbe||_t(_0x23b090);const _0x7ffb8a=_0x2b1af9['map'](_0x392390=>Bt(_0x392390,this['_model'])),_0x1b011d=_0x2beb1c instanceof kt?_0x2beb1c:Bt(_0x2beb1c,this['_model']);_0x7ffb8a['push'](_0x1b011d);let _0x1c8802=!0x0;for(const _0x19c032 of _0x7ffb8a)if(!this['J'](_0x19c032)){_0x1c8802=!0x1;break;}if(_0x1c8802){return void this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x42ffbe,'accept')([_0x1b011d],_0x23b090);}let _0x57ac5b=null,_0x479d79=_0x1b011d['start'],_0x9936ee=_0x1b011d['end'];for(const {suggestion:_0x2d506f,meta:_0x38adc1}of this['R'](_0x1b011d,'formatBlock')){if(!_0x38adc1['isOwn']||_0x38adc1['isNextTo']||_0x38adc1['containsRangeInObject']||_0x38adc1['isInsideObject'])continue;if(_0x2d506f['data']['formatGroupId']!=_0x23b090['formatGroupId'])continue;const _0x459ff9=_0x2d506f['getFirstRange']();if(_0x2d506f['subType']==_0x42ffbe){if(_0x459ff9['containsRange'](_0x1b011d,!0x0))return;_0x479d79=_0x479d79['isBefore'](_0x459ff9['start'])?_0x479d79:_0x459ff9['start'],_0x9936ee=_0x9936ee['isAfter'](_0x459ff9['end'])?_0x9936ee:_0x459ff9['end'],_0x57ac5b?_0x459ff9['start']['isBefore'](_0x57ac5b['getFirstRange']()['start'])?(_0x57ac5b['removeMarkers'](),_0x57ac5b=_0x2d506f):_0x2d506f['removeMarkers']():_0x57ac5b=_0x2d506f;}else{const _0x14ffe6=_0x1b011d['getIntersection'](_0x459ff9);this['K'](_0x2d506f,_0x14ffe6);}}const _0x1ff612=this['editor']['plugins']['get']('Users')['me'],_0x2a5e64=ht(),_0x2e18a8=_0x1ff612['id'];_0x57ac5b?this['q'](_0x57ac5b,this['_model']['createRange'](_0x479d79,_0x9936ee)):(this['W']({'id':_0x2a5e64,'type':'formatBlock:'+_0x42ffbe,'data':_0x23b090,'createdAt':new Date(),'authorId':_0x2e18a8}),this['H']('formatBlock:'+_0x42ffbe,_0x2a5e64,_0x2e18a8,this['_model']['createRange'](_0x479d79,_0x9936ee)));}['markDeletion'](_0x396e1f,_0x15f39b=null){if(_0x396e1f['isCollapsed'])return null;const _0x26068=this['editor']['plugins']['get']('Users')['me'],_0x14395a=new _0x18210e(_0x396e1f['start'],_0x396e1f['end']);for(const {suggestion:_0x46d3c1,meta:_0x3777ba}of this['R'](_0x14395a,'insertion'))if(_0x3777ba['isOwn']&&!_0x3777ba['isNextTo'])if(_0x46d3c1['isMultiRange']){const _0x313692=_0x46d3c1['getRanges']();_0x313692['every'](_0x48275b=>_0x14395a['containsRange'](_0x48275b,!0x0))&&_0x46d3c1['discard']();if(_0x313692['some'](_0x20e6cd=>_0x20e6cd['containsRange'](_0x14395a,!0x0))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x15f39b,'accept')([_0x14395a]),null;}}else{const _0x51b893=_0x14395a['getIntersection'](_0x46d3c1['getFirstRange']());_0x46d3c1['_onDiscard']([_0x51b893]);}if(_0x14395a['detach'](),_0x14395a['isCollapsed']||'$graveyard'==_0x14395a['root']['rootName'])return null;let _0x313bff=null,_0x4dd6f6=_0x14395a['start'],_0x314a55=_0x14395a['end'];for(const {suggestion:_0xb5eb0f,meta:_0x47fed9}of this['R'](_0x14395a,'deletion'))if(_0x47fed9['isOwn'])if(_0xb5eb0f['isMultiRange']){let _0x20e5ed=!0x0;for(const _0x28752c of _0xb5eb0f['getRanges']()){if(_0x28752c['containsRange'](_0x14395a,!0x0))return _0xb5eb0f;_0x14395a['containsRange'](_0x28752c)||(_0x20e5ed=!0x1);}_0x20e5ed&&_0xb5eb0f['discard']();}else{const _0x50afd1=_0xb5eb0f['getFirstRange']();if(_0x50afd1['containsRange'](_0x14395a,!0x0))return _0xb5eb0f;_0x4dd6f6=_0x4dd6f6['isBefore'](_0x50afd1['start'])?_0x4dd6f6:_0x50afd1['start'],_0x314a55=_0x314a55['isAfter'](_0x50afd1['end'])?_0x314a55:_0x50afd1['end'],_0x313bff?_0x50afd1['start']['isBefore'](_0x313bff['getFirstRange']()['start'])?(_0x313bff['removeMarkers'](),_0x313bff=_0xb5eb0f):_0xb5eb0f['removeMarkers']():_0x313bff=_0xb5eb0f;}if(_0x313bff)return this['q'](_0x313bff,this['_model']['createRange'](_0x4dd6f6,_0x314a55)),_0x313bff;{const _0x2b1ab4=ht(),_0x4f6395=this['_model']['createRange'](_0x4dd6f6,_0x314a55),_0x3a4570=_0x26068['id'],_0x2ff729=_0x15f39b?'deletion:'+_0x15f39b:'deletion',_0x44ec41=this['W']({'id':_0x2b1ab4,'type':_0x2ff729,'createdAt':new Date(),'authorId':_0x3a4570});return this['H'](_0x2ff729,_0x2b1ab4,_0x3a4570,_0x4f6395),_0x44ec41;}}['markMultiRangeDeletion'](_0xb7ca48,_0x385107='multi'){const _0x37f125=this['editor']['plugins']['get']('Users')['me'],_0x596570=_0xb7ca48['map'](_0x15f615=>new _0x18210e(_0x15f615['start'],_0x15f615['end'])),_0x513958=new Set();for(const _0x35e643 of _0x596570)for(const {suggestion:_0x45f244,meta:_0x5d5252}of this['R'](_0x35e643,'insertion'))_0x5d5252['isOwn']&&!_0x5d5252['isNextTo']&&_0x513958['add'](_0x45f244);for(const _0x1bcaf7 of _0x513958)if(_0x1bcaf7['isMultiRange']){const _0x13fe65=_0x1bcaf7['getRanges']();_0x13fe65['every'](_0x122279=>_0x596570['some'](_0x2e7638=>_0x2e7638['containsRange'](_0x122279,!0x0)))&&_0x1bcaf7['discard']();if(_0x596570['every'](_0x1d4ca2=>_0x13fe65['some'](_0x323b8f=>_0x323b8f['containsRange'](_0x1d4ca2,!0x0)))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x385107,'accept')(_0xb7ca48),null;}}else{const _0x330124=_0x1bcaf7['getFirstRange']();_0x596570['some'](_0x2908d9=>_0x2908d9['containsRange'](_0x330124,!0x0))&&_0x1bcaf7['discard']();if(_0x596570['every'](_0x4fccaf=>_0x330124['containsRange'](_0x4fccaf,!0x0))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x385107,'accept')(_0x596570),null;}}const _0x594e18=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x385107,'join');let _0x141e38=null;for(const _0x24b83c of this['getSuggestions']())if(_0x24b83c['author']['id']==_0x37f125['id']&&_0x24b83c['isInContent']&&'deletion'==_0x24b83c['type']&&_0x24b83c['subType']==_0x385107&&(_0x594e18(_0x24b83c['getRanges'](),_0xb7ca48)||_0x594e18(_0xb7ca48,_0x24b83c['getRanges']())))if(_0x141e38){if(_0x24b83c['commentThread']&&_0x24b83c['commentThread']['length'])continue;for(const _0x491add of _0x24b83c['getRanges']())_0x141e38['addRange'](_0x491add);_0x24b83c['removeMarkers']();}else{_0x141e38=_0x24b83c;for(const _0x36940c of _0xb7ca48)_0x24b83c['addRange'](_0x36940c);}if(_0x141e38)return _0x141e38;_0x513958['clear']();for(const _0x55b34f of _0x596570)for(const {suggestion:_0x3790a0,meta:_0x123e6c}of this['R'](_0x55b34f,'deletion'))_0x123e6c['isOwn']&&_0x513958['add'](_0x3790a0);for(const _0x5dd149 of _0x513958){const _0x147c3c=_0x5dd149['getRanges']();if(_0x596570['every'](_0x56ef55=>_0x147c3c['some'](_0x282e70=>_0x282e70['containsRange'](_0x56ef55,!0x0))))return _0x5dd149;_0x147c3c['every'](_0x3456e9=>_0x596570['some'](_0x2b8373=>_0x2b8373['containsRange'](_0x3456e9,!0x0)))&&_0x5dd149['discard']();}const _0x3e9189=ht(),_0x3aff6f=_0x37f125['id'],_0x18a7c0='deletion:'+_0x385107,_0x3798fb=this['W']({'id':_0x3e9189,'type':_0x18a7c0,'createdAt':new Date(),'authorId':_0x3aff6f});for(const _0x367d1 of _0x596570)_0x367d1['detach'](),_0x367d1['isCollapsed']||'$graveyard'==_0x367d1['root']['rootName']||this['H'](_0x18a7c0,_0x3e9189,_0x3aff6f,_0x367d1,ot['getMultiRangeId']());return _0x3798fb;}['q'](_0x23a1e1,_0x59af86){const _0x5bd1fa=_0x23a1e1['getFirstMarker']();this['_model']['change'](_0xc57f49=>{_0xc57f49['updateMarker'](_0x5bd1fa,{'range':_0x59af86});});}['F'](_0x5a417b){const _0x4dfc07=_0x5a417b['id'],_0x4dd54f=this['editor']['config']['get']('collaboration.channelId');this['_']['hasCommentThread'](_0x4dfc07)||this['_']['addCommentThread']({'channelId':_0x4dd54f,'threadId':_0x4dfc07}),_0x5a417b['commentThread']=this['_']['getCommentThread'](_0x4dfc07);}['L'](_0x87ba6e,_0x237587,_0x2a0dba,_0x4913c8){if(_0x87ba6e['type']!=_0x237587||_0x87ba6e['subType']!=_0x2a0dba||_0x87ba6e['author']['id']!=_0x4913c8)throw this['editor']['isReadOnly']=!0x0,new _0x3a7c90('track-changes-suggestion-data-mismatch:\x20Suggestion\x20marker\x20name\x20does\x20not\x20match\x20loaded\x20suggestion\x20data.',this);}['K'](_0x491475,_0x578358){const _0x6637db=_0x491475['getFirstRange']();if(_0x578358['isEqual'](_0x6637db))_0x491475['removeMarkers']();else if(_0x6637db['containsRange'](_0x578358)){const _0xc8683e=this['_model']['createPositionAt'](_0x578358['start']['nodeBefore'],'end');this['q'](_0x491475,this['_model']['createRange'](_0x6637db['start'],_0xc8683e));const _0xfa7996=ht(),_0x976a7a=_0x491475['author']['id'],_0x57a108=_0x491475['type']+':'+_0x491475['subType'];this['W']({'id':_0xfa7996,'type':_0x57a108,'createdAt':new Date(),'authorId':_0x976a7a,'data':_0x491475['data']});const _0x3d83e3=this['_model']['createPositionAt'](_0x578358['end']['parent'],'after'),_0xe5819e=this['_model']['createRange'](_0x3d83e3,_0x6637db['end']);this['H'](_0x57a108,_0xfa7996,_0x976a7a,_0xe5819e);}else if(_0x6637db['containsPosition'](_0x578358['start'])){const _0x13cd7c=this['_model']['createPositionAt'](_0x578358['start']['nodeBefore'],'end');this['q'](_0x491475,this['_model']['createRange'](_0x6637db['start'],_0x13cd7c));}else{const _0x29b9c3=this['_model']['createPositionAt'](_0x578358['end']['parent'],'after');this['q'](_0x491475,this['_model']['createRange'](_0x29b9c3,_0x6637db['end']));}}['J'](_0x1eacb3){for(const {suggestion:_0x282054,meta:_0x33e938}of this['R'](_0x1eacb3,'insertion')){if(!_0x33e938['isOwn'])continue;const _0x5c9467=_0x282054['getRanges']();for(const _0x4c8313 of _0x5c9467)if(!_0x1eacb3['getDifference'](_0x4c8313)['length'])return!0x0;}return!0x1;}['V'](_0x57d113){const _0x17bef7=this['editor']['plugins']['get']('Users')['getUser'](_0x57d113);if(!_0x17bef7)throw new _0x3a7c90('track-changes-user-not-found:\x20User\x20with\x20given\x20id\x20not\x20found.',this);return _0x17bef7;}['G'](_0x5ae973,_0x4c6642,_0x2b09d4,_0x4b3548){const _0x306236=this['V'](_0x4b3548),_0x2ae2c1=this['_suggestionFactory']['buildSuggestion'](_0x5ae973,_0x4c6642,_0x2b09d4,_0x306236);return this['listenTo'](_0x2ae2c1,'accept',()=>{this['P'](_0x2b09d4,{'state':'accepted'});},{'priority':'high'}),this['listenTo'](_0x2ae2c1,'discard',()=>{this['P'](_0x2b09d4,{'state':'rejected'});},{'priority':'high'}),this['_suggestions']['set'](_0x2b09d4,_0x2ae2c1),this['B']['set'](_0x2ae2c1,'notReady'),_0x2ae2c1;}['_splitMarkerName'](_0x13df3c){const _0x871f6f=_0x13df3c['split'](':');return{'group':_0x871f6f[0x0],'type':_0x871f6f[0x1],'subType':_0x871f6f['length']>=0x5?_0x871f6f[0x2]:null,'id':_0x871f6f['length']<0x5?_0x871f6f[0x2]:_0x871f6f[0x3],'authorId':_0x871f6f['length']<0x5?_0x871f6f[0x3]:_0x871f6f[0x4],'markerCount':0x6==_0x871f6f['length']?_0x871f6f[0x5]:null};}['O'](_0x996555,_0x26c5f3,_0x2c5dcf){const _0x28ce3c=_0x996555['getFirstRange'](),_0x4addfc=_0x28ce3c['start'],_0x42b147=_0x28ce3c['end'];this['q'](_0x996555,this['_model']['createRange'](_0x4addfc,_0x26c5f3));const _0x503aa6=ht(),_0x490625=_0x996555['author']['id'],_0x28ac09=_0x996555['type']+(_0x996555['subType']?':'+_0x996555['subType']:'');this['W']({'id':_0x503aa6,'type':_0x28ac09,'createdAt':new Date(),'authorId':_0x490625,'originalSuggestionId':_0x996555['id'],'data':_0x996555['data']}),'formatBlock'==_0x996555['type']&&(_0x2c5dcf=this['_model']['createPositionBefore'](_0x2c5dcf['parent'])),this['H'](_0x28ac09,_0x503aa6,_0x490625,this['_model']['createRange'](_0x2c5dcf,_0x42b147));}['R'](_0x28cc51,_0x4377e6=null){const _0x226f19=[],_0x5d01e8=this['_model']['schema'],_0x40a24d=this['editor']['plugins']['get']('Users')['me'];for(const _0x3da73b of this['getSuggestions']())if(_0x3da73b['isInContent']&&(!_0x4377e6||_0x3da73b['type']==_0x4377e6))for(const _0x2a0ed3 of _0x3da73b['getRanges']()){const _0x5ae1ab=_0x28cc51['start']['isEqual'](_0x2a0ed3['end'])||_0x28cc51['end']['isEqual'](_0x2a0ed3['start']);if(_0x5ae1ab||_0x28cc51['getIntersection'](_0x2a0ed3)){const _0x536a8f=_0x28cc51['containsRange'](_0x2a0ed3)&&Dt(_0x5d01e8,_0x2a0ed3['start'],_0x28cc51),_0x5d9c7b=_0x2a0ed3['containsRange'](_0x28cc51)&&Dt(_0x5d01e8,_0x28cc51['start'],_0x2a0ed3);_0x226f19['push']({'suggestion':_0x3da73b,'meta':{'isOwn':_0x40a24d==_0x3da73b['author'],'isNextTo':_0x5ae1ab,'isInsideObject':_0x536a8f,'containsRangeInObject':_0x5d9c7b}});break;}}return _0x226f19;}['H'](_0x1eadd1,_0xf0ea30,_0x24ea86,_0x3a9f75,_0x33f9be=null){this['_model']['change'](_0x130075=>{let _0x4ad022='suggestion:'+_0x1eadd1+':'+_0xf0ea30+':'+_0x24ea86;_0x33f9be&&(_0x4ad022=_0x4ad022+':'+_0x33f9be),_0x130075['addMarker'](_0x4ad022,{'range':_0x3a9f75,'usingOperation':!0x0,'affectsData':!0x0});});}['U'](_0x24229c){const _0x1b4885=_0x24229c['previous'],_0x211c1f=_0x24229c['next'];_0x24229c['previous']=null,null!=_0x1b4885&&(_0x1b4885['next']=null),_0x24229c['next']=null,'ready'==this['B']['get'](_0x24229c)&&(this['B']['set'](_0x24229c,'removed'),this['fire']('suggestionUnloaded',_0x24229c,_0x1b4885,_0x211c1f)),null!=_0x211c1f&&(_0x211c1f['previous']=null);}['W'](_0x3a1179){const _0x15fe1d=_0x3a1179['id'],_0x3ed7c5=this['addSuggestionData'](_0x3a1179);if(this['D']&&this['D']['addSuggestion']){const _0x107a57=this['editor']['plugins']['get']('PendingActions'),_0x8d43da=_0x3ed7c5['hasComments'],_0x425c63=_0x3ed7c5['subType']?_0x3ed7c5['type']+':'+_0x3ed7c5['subType']:_0x3ed7c5['type'],t=this['editor']['locale']['t'],_0x7cb65b=_0x107a57['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'})),_0x33933b={'id':_0x15fe1d,'type':_0x425c63,'hasComments':_0x8d43da,'data':_0x3a1179['data']||null,'originalSuggestionId':_0x3a1179['originalSuggestionId']||null};this['D']['addSuggestion'](_0x33933b)['then'](_0x212a88=>{_0x107a57['remove'](_0x7cb65b),_0x212a88&&_0x212a88['createdAt']&&(this['_suggestions']['get'](_0x15fe1d)['createdAt']=_0x212a88['createdAt']);});}return _0x3ed7c5;}['P'](_0x5c4d46,_0x36bc05){const _0xa9a63=this['editor']['plugins']['get']('PendingActions');if(this['D']&&this['D']['updateSuggestion']){const t=this['editor']['locale']['t'],_0x2fc621=_0xa9a63['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'}));this['D']['updateSuggestion'](_0x5c4d46,_0x36bc05)['then'](()=>{_0xa9a63['remove'](_0x2fc621);});}}['X'](_0xa5df0d){if(!this['D']||!this['D']['getSuggestion'])throw new _0x3a7c90('track-changes-adapter-missing-getsuggestion:\x20Adapter\x20not\x20set\x20or\x20is\x20missing\x20`getSuggestion()`\x20method.',this);return this['D']['getSuggestion'](_0xa5df0d);}['M'](_0xc6de3e){const {id:_0x3fd584,type:_0xacdb38,subType:_0x46ff27,authorId:_0x407497}=this['_splitMarkerName'](_0xc6de3e),_0x26af1c=this['_suggestions']['get'](_0x3fd584)||this['G'](_0xacdb38,_0x46ff27,_0x3fd584,_0x407497);switch(this['L'](_0x26af1c,_0xacdb38,_0x46ff27,_0x407497),this['B']['get'](_0x26af1c)){case'notReady':this['X'](_0x3fd584)['then'](_0x46e590=>{let _0x29bed3=Promise['resolve']();_0x46e590['hasComments']&&(_0x29bed3=this['_']['fetchCommentThread']({'channelId':this['editor']['config']['get']('collaboration.channelId'),'threadId':_0x3fd584})),_0x29bed3['then'](()=>{this['addSuggestionData'](_0x46e590);});}),this['B']['set'](_0x26af1c,'markerReady');break;case'removed':this['P'](_0x3fd584,{'state':'open'});case'dataReady':this['B']['set'](_0x26af1c,'ready'),this['fire']('suggestionLoaded',_0x26af1c);break;case'ready':this['fire']('suggestionChanged',_0x26af1c);}_0x26af1c['addMarkerName'](_0xc6de3e),this['N'](_0x26af1c);}['N'](_0x162710){if('formatInline'==_0x162710['type']||'formatBlock'==_0x162710['type'])return;if(_0x162710['isMultiRange'])return;let _0x45af1b=!0x0;for(const _0x425585 of this['getSuggestions']())if(!_0x425585['isMultiRange']&&_0x425585!=_0x162710&&_0x425585['isInContent']&&'formatInline'!=_0x425585['type']&&'formatBlock'!=_0x425585['type']&&_0x425585['author']['id']==_0x162710['author']['id']){if(this['Y'](_0x425585,_0x162710)){if(_0x162710['commentThread']&&_0x162710['commentThread']['length'])continue;_0x425585['next']=_0x162710,_0x162710['previous']=_0x425585,_0x45af1b=!0x1;}if(this['Y'](_0x162710,_0x425585)){if(_0x425585['commentThread']&&_0x425585['commentThread']['length'])continue;_0x162710['next']=_0x425585,_0x425585['previous']=_0x162710;}}_0x162710['previous']&&_0x45af1b&&(_0x162710['previous']['next']=null,_0x162710['previous']=null);}['Y'](_0x47f8e6,_0x42966b){const _0x1eb607=_0x47f8e6['getFirstRange'](),_0x264974=_0x42966b['getFirstRange']();if(_0x1eb607['end']['isEqual'](_0x264974['start']))return!0x0;if(_0x47f8e6['type']!=_0x42966b['type'])return!0x1;if(!_0x1eb607['end']['isTouching'](_0x264974['start']))return!0x1;const _0x464b1c=new wt({'boundaries':this['editor']['model']['createRange'](_0x1eb607['end'],_0x264974['start'])});for(const _0x1f56c5 of _0x464b1c)if('elementEnd'==_0x1f56c5['type']&&this['editor']['model']['schema']['isLimit'](_0x1f56c5['item']))return!0x1;return!0x0;}['j'](_0x131a83){for(const _0x1929d9 of this['_suggestions']['values']()){if(_0x1929d9==_0x131a83||!_0x1929d9['isInContent'])continue;if(_0x1929d9['type']!=_0x131a83['type']||_0x1929d9['author']['id']!=_0x131a83['author']['id']||_0x1929d9['subType']!=_0x131a83['subType'])continue;const _0x2a5fcb=this['_suggestionFactory']['getSuggestionCallback'](_0x131a83['type'],_0x131a83['subType'],'join');if(_0x2a5fcb(_0x1929d9['getRanges'](),_0x131a83['getRanges']())){if(_0x131a83['commentThread']&&_0x131a83['commentThread']['length'])continue;return this['Z'](_0x1929d9,_0x131a83),!0x0;}if(_0x2a5fcb(_0x131a83['getRanges'](),_0x1929d9['getRanges']())){if(_0x1929d9['commentThread']&&_0x1929d9['commentThread']['length'])continue;return this['Z'](_0x131a83,_0x1929d9),!0x0;}}return!0x1;}['Z'](_0xe4b5fd,_0x4c03dd){if(_0xe4b5fd['isMultiRange'])for(const _0x397019 of _0x4c03dd['getRanges']())_0xe4b5fd['addRange'](_0x397019);else{const _0x1cac18=_0x4c03dd['getFirstRange']()['end'];this['q'](_0xe4b5fd,this['_model']['createRange'](_0xe4b5fd['getFirstRange']()['start'],_0x1cac18));}_0x4c03dd['removeMarkers']();}}nt(gt,It);class vt{constructor(_0x527e99){this['tt']=_0x527e99,this['_model']=_0x527e99['model'],this['$']=new Map(),this['it']=new Map(),this['et']();}['buildSuggestion'](_0x278db0,_0x37be56,_0x299283,_0x1fa178){return new ot(this['_model'],{'type':_0x278db0,'subType':_0x37be56,'id':_0x299283,'author':_0x1fa178,'onAccept':(..._0x82f1fe)=>this['getSuggestionCallback'](_0x278db0,_0x37be56,'accept')(..._0x82f1fe),'onDiscard':(..._0x2b4791)=>this['getSuggestionCallback'](_0x278db0,_0x37be56,'discard')(..._0x2b4791)});}['registerCustomCallback'](_0x34fd4a,_0x222639,_0x5c7753,_0x556abd){const _0x29daf0=_0x34fd4a+':'+_0x222639+':'+_0x5c7753;this['$']['set'](_0x29daf0,_0x556abd);}['getSuggestionCallback'](_0x24bace,_0x495db0,_0x3b9cb8){const _0xc1de1b=_0x24bace+':'+_0x495db0+':'+_0x3b9cb8;return this['$']['get'](_0xc1de1b)||this['it']['get'](_0x24bace+':'+_0x3b9cb8);}['et'](){const _0x2bfd33=()=>{},_0x343d93=_0x3fe82c=>{_0x3fe82c['sort']((_0x37d8e9,_0x6d40d7)=>_0x37d8e9['start']['isBefore'](_0x6d40d7['start'])?0x1:-0x1),this['_model']['change'](_0x1c093e=>{for(const _0x4d9ba5 of _0x3fe82c){let _0x3ced29;_0x3ced29=_0x4d9ba5['end']['isAtEnd']&&_0x4d9ba5['end']['parent']==_0x4d9ba5['start']['nodeAfter']?_0x1c093e['createSelection'](_0x4d9ba5['start']['nodeAfter'],'on'):_0x1c093e['createSelection'](_0x4d9ba5),this['_model']['deleteContent'](_0x3ced29,{'forceDefaultExecution':!0x0,'doNotAutoparagraph':!0x0});}});},_0x1f504b=(_0x385f05,_0x15a63c)=>{this['_model']['change'](_0x2b9977=>{const {commandName:_0x172b2a,commandParams:_0x433b6a}=_0x15a63c,_0x5dcd06=_0x385f05[0x0];if('$graveyard'==_0x5dcd06['root']['rootName'])return;const _0x3167ff=_0x18210e['fromRange'](this['_model']['document']['selection']['getFirstRange']());var _0x12ef74;(_0x12ef74=_0x5dcd06)['end']['parent']==_0x12ef74['start']['nodeAfter']&&0x0==_0x12ef74['end']['offset']?_0x2b9977['setSelection'](this['_model']['createRange'](_0x5dcd06['end'])):_0x2b9977['setSelection'](_0x5dcd06),this['tt']['commands']['get'](_0x172b2a)['refresh'](),_0x433b6a['push']({'forceDefaultExecution':!0x0}),this['tt']['execute'](_0x172b2a,..._0x433b6a),'$graveyard'!=_0x3167ff['root']['rootName']&&_0x2b9977['setSelection'](_0x3167ff),_0x3167ff['detach']();});},_0x57da07=(_0x47b124,_0x2833ab)=>0x1==_0x47b124['length']&&0x1==_0x2833ab['length']&&_0x47b124[0x0]['end']['isEqual'](_0x2833ab[0x0]['start']);this['it']['set']('insertion:accept',_0x2bfd33),this['it']['set']('insertion:discard',_0x343d93),this['it']['set']('insertion:join',_0x57da07),this['it']['set']('deletion:accept',_0x343d93),this['it']['set']('deletion:discard',_0x2bfd33),this['it']['set']('deletion:join',_0x57da07),this['it']['set']('formatInline:accept',_0x1f504b),this['it']['set']('formatInline:discard',_0x2bfd33),this['it']['set']('formatInline:join',_0x57da07),this['it']['set']('formatBlock:accept',_0x1f504b),this['it']['set']('formatBlock:discard',_0x2bfd33),this['it']['set']('formatBlock:join',_0x57da07);}}function Dt(_0x52a747,_0x3a1569,_0x25e0b1){for(const _0x50f0f4 of _0x3a1569['parent']['getAncestors']({'includeSelf':!0x0,'parentFirst':!0x0})){if(_0x50f0f4['root']==_0x50f0f4)return!0x1;if(!_0x25e0b1['containsItem'](_0x50f0f4))return!0x1;if(_0x52a747['isObject'](_0x50f0f4)||_0x52a747['isLimit'](_0x50f0f4))return!0x0;}}function Ct(_0x2d9b84,_0x2464bf,_0x5dcdd5,_0x2cc27f){const _0x121cf8=_0x2d9b84['start']['getLastMatchingPosition'](_0x42a2b5=>!_0x42a2b5['item']['is']('textProxy')&&!_0x2cc27f['isObject'](_0x42a2b5['item'])),_0x171037=_0x2d9b84['end']['getLastMatchingPosition'](_0x449ab2=>!_0x449ab2['item']['is']('textProxy')&&!_0x2cc27f['isObject'](_0x449ab2['item']),{'direction':'backward'});if(!_0x2d9b84['start']['isEqual'](_0x121cf8)||!_0x2d9b84['end']['isEqual'](_0x171037)){const _0x2098f7=_0x5dcdd5['createRange'](_0x121cf8,_0x171037);return _0x5dcdd5['updateMarker'](_0x2464bf,{'range':_0x2098f7}),!0x0;}return!0x1;}function _t(_0x865d8c){return bt(_0x865d8c);}function At(_0x38646e){const _0x5731a8=_0x38646e['start']['nodeAfter'];return _0x5731a8&&_0x5731a8['is']('element');}function Bt(_0x194a83,_0x170ce9){return _0x170ce9['createRange'](_0x170ce9['createPositionAt'](_0x194a83,'before'),_0x170ce9['schema']['isObject'](_0x194a83)?_0x170ce9['createPositionAfter'](_0x194a83):_0x170ce9['createPositionAt'](_0x194a83,'end'));}