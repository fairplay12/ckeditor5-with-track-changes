/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x3681be from'@ckeditor/ckeditor5-core/src/plugin';import _0x7a8ef9 from'../annotations/annotations';import _0xd590f4 from'./commentsrepository';import _0x32542a from'./commentsediting';import _0x476702 from'../annotations/editorannotations';import _0x1a2d22 from'@ckeditor/ckeditor5-ui/src/button/buttonview';import _0x2cb883 from'../../theme/icons/add-comment.svg';export default class G extends _0x3681be{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x7a8ef9,_0xd590f4,_0x32542a,_0x476702];}['init'](){const _0x4073dd=this['editor'],_0x1e93d9=_0x4073dd['model'],_0x288ce3=_0x4073dd['plugins']['get']('CommentsRepository'),_0x17ad75=_0x4073dd['plugins']['get']('CommentsEditing'),_0x195a17=_0x4073dd['plugins']['get']('Annotations'),_0x1d08fd=_0x4073dd['plugins']['get']('EditorAnnotations');_0x4073dd['ui']['componentFactory']['add']('comment',()=>this['ut']()),_0x1d08fd['addSourceCollector'](()=>{const _0x4fafdd=[];for(const [_0x3c4076,_0x334384]of _0x288ce3['_threadToController']){const _0x24a2ac=_0x1e93d9['markers']['get']('comment:'+_0x3c4076['id']);_0x24a2ac&&_0x4fafdd['push']([_0x334384['view'],[_0x24a2ac['getRange']()]]);}return _0x4fafdd;}),this['listenTo'](_0x195a17,'change:activeView',(_0x343cbf,_0x4ddbd7,_0x5ea3b2)=>{if(!_0x288ce3['_viewToController']['has'](_0x5ea3b2))return void(_0x17ad75['activeMarker']=null);const _0x526632='comment:'+_0x288ce3['_viewToController']['get'](_0x5ea3b2)['model']['id'];_0x1e93d9['markers']['has'](_0x526632)&&_0x17ad75['activeMarker']!=_0x526632?_0x17ad75['activeMarker']=_0x526632:_0x17ad75['activeMarker']&&(_0x17ad75['activeMarker']=null);}),this['listenTo'](_0x288ce3,'removeCommentThread',(_0x17543a,{threadId:_0x2494b0,isFromAdapter:_0x3a773d})=>{if(_0x3a773d||!_0x4073dd['ui']['focusTracker']['isFocused'])return;_0x4073dd['model']['markers']['get']('comment:'+_0x2494b0)&&_0x4073dd['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x288ce3,'addComment',(_0x46f3ff,{threadId:_0x10cb80,isFromAdapter:_0x1bb313})=>{const _0x12ae89=_0x1e93d9['markers']['get']('comment:'+_0x10cb80);if(_0x1bb313||!_0x12ae89||!_0x288ce3['hasCommentThread'](_0x10cb80))return;0x1===_0x288ce3['getCommentThread'](_0x10cb80)['length']&&(_0x4073dd['editing']['view']['focus'](),_0x46f3ff['stop']());},{'priority':'low'});}['ut'](){const _0x36d672=this['editor'],_0x51c942=new _0x1a2d22(_0x36d672['locale']),_0x3e9374=_0x36d672['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x51c942['label']=t('Comment'),_0x51c942['tooltip']=t('Comment'),_0x51c942['icon']=_0x2cb883,_0x51c942['bind']('isEnabled')['to'](_0x3e9374),this['listenTo'](_0x51c942,'execute',()=>_0x3e9374['execute']()),_0x51c942;}}