/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3b3b=['ck-comment-marker--active','view','getCommentThread','isObject','activeMarker','createRange','schema','isCollapsed','document','editingDowncast','stop','hasContent','markerName','_detachCommentThread','differ','text','once','CommentsRepository','name','registerPostFixer','start','isOpening','set','length','upcast','newRange','ck-comment-marker','editor','markerToElement','comment','openNewCommentThread','get','hasCommentThread','updateMarker','collaboration.channelId','switchReadOnly','low','_threads','createUIElement','delete','for','change','getWalker','then','ready','commands','conversion','dataDowncast','end','attachTo','fetchCommentThread','getAttribute','split','comment:','root','state','markers','requires','render','destroyed','getCommentThreads','isThreadsLoadingPaused','size','push','elementToMarker','managedUsingOperations','listenTo','addComment','init','destroy','removeMarker','plugins','config','has','data','add','_changedMarkers','model','editing'];(function(_0x10ef5f,_0x3b3bef){const _0x5ae772=function(_0x36e22c){while(--_0x36e22c){_0x10ef5f['push'](_0x10ef5f['shift']());}};_0x5ae772(++_0x3b3bef);}(_0x3b3b,0xab));const _0x5ae7=function(_0x10ef5f,_0x3b3bef){_0x10ef5f=_0x10ef5f-0x0;let _0x5ae772=_0x3b3b[_0x10ef5f];return _0x5ae772;};import _0x37d81b from'@ckeditor/ckeditor5-core/src/plugin';import _0x3874bc from'./commentsrepository';import _0x5c6e0d from'./addcommentthreadcommand';import _0x3c030b from'../utils/getmarkerdomelement';import _0x485e5d from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class F extends _0x37d81b{static get[_0x5ae7('0x2c')](){return[_0x3874bc,_0x485e5d];}static get['pluginName'](){return'CommentsEditing';}constructor(_0x31a83a){super(_0x31a83a),this[_0x5ae7('0x9')](_0x5ae7('0x30'),!0x0),_0x31a83a[_0x5ae7('0x3d')][_0x5ae7('0x3')](_0x5ae7('0x1f'),()=>this[_0x5ae7('0x30')]=!0x1),this[_0x5ae7('0x9')](_0x5ae7('0x46'),null),this['on']('change:activeMarker',(_0x5108e5,_0x44dd8b,_0x516390,_0xa7cadd)=>{_0x31a83a[_0x5ae7('0x40')]['change'](_0x2b0bc8=>{_0x31a83a[_0x5ae7('0x40')][_0x5ae7('0x2b')][_0x5ae7('0x3c')](_0x516390)&&_0x2b0bc8[_0x5ae7('0x14')](_0x516390),_0x31a83a[_0x5ae7('0x40')][_0x5ae7('0x2b')][_0x5ae7('0x3c')](_0xa7cadd)&&_0x2b0bc8[_0x5ae7('0x14')](_0xa7cadd);});});}[_0x5ae7('0x37')](){const _0xa625f2=this[_0x5ae7('0xe')],_0x1e9e6b=_0xa625f2[_0x5ae7('0x3a')][_0x5ae7('0x12')](_0x5ae7('0x4')),_0x218695=_0xa625f2[_0x5ae7('0x3b')][_0x5ae7('0x12')]('collaboration.channelId');_0xa625f2[_0x5ae7('0x20')]['add']('addCommentThread',new _0x5c6e0d(_0xa625f2)),this[_0x5ae7('0x35')](_0xa625f2,'change:isReadOnly',(_0x55d3c5,_0x24f050,_0x24d97a)=>{_0x1e9e6b[_0x5ae7('0x16')](_0x24d97a,_0xa625f2['config'][_0x5ae7('0x12')](_0x5ae7('0x15')));}),this[_0x5ae7('0x35')](_0x1e9e6b,$('removeCommentThread',_0x218695),(_0x24d5ed,{threadId:_0x1dcfaf})=>{const _0x5d030a=_0xa625f2[_0x5ae7('0x40')][_0x5ae7('0x2b')][_0x5ae7('0x12')](_0x5ae7('0x28')+_0x1dcfaf),_0x2fd812=_0x1e9e6b[_0x5ae7('0x44')](_0x1dcfaf);_0x5d030a&&_0xa625f2['model']['change'](_0x126fc7=>{_0x126fc7['removeMarker'](_0x5d030a);}),_0x1e9e6b['hasCommentThread'](_0x1dcfaf)&&!_0x2fd812[_0x5ae7('0xa')]||_0x24d5ed[_0x5ae7('0x4c')]();},{'priority':'high'}),this[_0x5ae7('0x35')](_0x1e9e6b,$(_0x5ae7('0x36'),_0x218695),(_0x7c5952,{threadId:_0x506c53,isFromAdapter:_0x45e679})=>{const _0x21acef=_0xa625f2['model'][_0x5ae7('0x2b')][_0x5ae7('0x12')](_0x5ae7('0x28')+_0x506c53);if(_0x45e679||!_0x21acef||!_0x1e9e6b[_0x5ae7('0x13')](_0x506c53))return;0x1===_0x1e9e6b[_0x5ae7('0x44')](_0x506c53)[_0x5ae7('0xa')]&&_0xa625f2[_0x5ae7('0x40')][_0x5ae7('0x1c')](_0x581b8c=>{_0x581b8c[_0x5ae7('0x14')](_0x21acef,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x5ae7('0x17')}),this['$'](),this['tt']();}[_0x5ae7('0x38')](){const _0x5ca24f=this[_0x5ae7('0xe')][_0x5ae7('0x3a')][_0x5ae7('0x12')](_0x5ae7('0x4')),_0x18e296=this[_0x5ae7('0xe')][_0x5ae7('0x3b')][_0x5ae7('0x12')](_0x5ae7('0x15'));for(const _0x26d262 of _0x5ca24f[_0x5ae7('0x2f')]({'channelId':_0x18e296}))_0x5ca24f[_0x5ae7('0x0')](_0x26d262['id']),_0x5ca24f[_0x5ae7('0x18')][_0x5ae7('0x1a')](_0x26d262['id']);super[_0x5ae7('0x38')]();}['$'](){const _0x402c0b=this[_0x5ae7('0xe')];_0x402c0b[_0x5ae7('0x21')][_0x5ae7('0x1b')](_0x5ae7('0x4b'))['markerToHighlight']({'model':_0x5ae7('0x10'),'view':_0x3945a8=>{const {id:_0x274e87}=Q(_0x3945a8['markerName']),_0x2efb4a=[_0x5ae7('0xd')];return this[_0x5ae7('0x46')]===_0x3945a8[_0x5ae7('0x4e')]&&_0x2efb4a[_0x5ae7('0x32')](_0x5ae7('0x42')),{'classes':_0x2efb4a,'attributes':{'data-comment':_0x274e87}};}}),_0x402c0b[_0x5ae7('0x21')]['for'](_0x5ae7('0x22'))[_0x5ae7('0xf')]({'model':_0x5ae7('0x10'),'view':(_0x2b97a0,_0x5de407)=>{const _0x514fdd=_0x402c0b[_0x5ae7('0x40')][_0x5ae7('0x2b')]['get'](_0x2b97a0['markerName']),_0x36c57b=Q(_0x2b97a0[_0x5ae7('0x4e')])['id'];if(_0x514fdd['affectsData'])return _0x5de407[_0x5ae7('0x19')]('comment',{'id':_0x36c57b,'type':_0x2b97a0[_0x5ae7('0x8')]?_0x5ae7('0x7'):_0x5ae7('0x23')});}}),_0x402c0b[_0x5ae7('0x21')][_0x5ae7('0x1b')](_0x5ae7('0xb'))[_0x5ae7('0x33')]({'view':{'name':_0x5ae7('0x10'),'attribute':{'id':/^\w/}},'model':_0x67b334=>_0x5ae7('0x28')+_0x67b334[_0x5ae7('0x26')]('id')});}['tt'](){const _0x13ce83=this['editor'],_0x377d4f=_0x13ce83['plugins'][_0x5ae7('0x12')](_0x5ae7('0x4')),_0x2fff24=new Set(),_0x240246=new Set();_0x13ce83[_0x5ae7('0x40')][_0x5ae7('0x4a')][_0x5ae7('0x6')](_0x2f96fc=>{let _0x569848=!0x1;for(const [_0x1204fc,_0x3ac999]of _0x13ce83['model'][_0x5ae7('0x4a')][_0x5ae7('0x1')][_0x5ae7('0x3f')]){const {group:_0x25a02a,id:_0x419e36}=Q(_0x1204fc);let _0x54db0c=_0x3ac999[_0x5ae7('0xc')];if(_0x5ae7('0x10')!==_0x25a02a||!_0x54db0c)continue;const _0x2e054d=_0x240246[_0x5ae7('0x3c')](_0x419e36),_0xa3aae1='$graveyard'===_0x54db0c[_0x5ae7('0x29')]['rootName'];_0xa3aae1||(_0x54db0c=U(_0x54db0c,_0x13ce83[_0x5ae7('0x40')]),!_0x54db0c||_0x54db0c['isEqual'](_0x3ac999[_0x5ae7('0xc')]))?_0x54db0c&&(!_0x2e054d||!_0xa3aae1&&_0x13ce83[_0x5ae7('0x40')][_0x5ae7('0x4d')](_0x54db0c))?_0x2e054d||_0xa3aae1||(_0x240246[_0x5ae7('0x3e')](_0x419e36),this[_0x5ae7('0x30')]?_0x2fff24[_0x5ae7('0x3e')](_0x1204fc):this['et'](_0x1204fc)):(_0x2f96fc[_0x5ae7('0x39')](_0x1204fc),_0x569848=!0x0):(_0x2f96fc[_0x5ae7('0x14')](_0x1204fc,{'range':_0x54db0c}),_0x569848=!0x0);}return _0x569848;}),this['on']('change:isThreadsLoadingPaused',(_0x118e8a,_0x4a5d25,_0x5322f9)=>{if(!_0x5322f9&&_0x2fff24[_0x5ae7('0x31')])for(const _0x13f5ee of _0x2fff24)this['et'](_0x13f5ee),_0x2fff24[_0x5ae7('0x1a')](_0x13f5ee);}),this[_0x5ae7('0x35')](_0x13ce83[_0x5ae7('0x40')]['markers'],'update:comment',(_0x1884c5,_0x1505e6,_0xd22569,_0x1f92ef)=>{if(_0x1f92ef)return;const {id:_0x1e24ea}=Q(_0x1505e6[_0x5ae7('0x5')]),_0x30ef98=_0x13ce83[_0x5ae7('0x3a')][_0x5ae7('0x12')](_0x5ae7('0x4'))[_0x5ae7('0x44')](_0x1e24ea);_0x240246[_0x5ae7('0x1a')](_0x1e24ea),_0x2fff24[_0x5ae7('0x1a')](_0x1505e6[_0x5ae7('0x5')]),_0x30ef98&&_0x377d4f[_0x5ae7('0x0')](_0x1e24ea);});}['et'](_0x3a12e6){const _0x20f704=this['editor'],_0x468ce2=_0x20f704['plugins'][_0x5ae7('0x12')](_0x5ae7('0x4')),_0x586d32=_0x20f704['config'][_0x5ae7('0x12')](_0x5ae7('0x15')),_0x4bd6e3=_0x20f704[_0x5ae7('0x40')][_0x5ae7('0x2b')][_0x5ae7('0x12')](_0x3a12e6),{id:_0x1312b0}=Q(_0x3a12e6);_0x4bd6e3[_0x5ae7('0x34')]?_0x468ce2[_0x5ae7('0x25')]({'channelId':_0x586d32,'threadId':_0x1312b0})[_0x5ae7('0x1e')](_0x103b2b=>{_0x5ae7('0x2e')!==_0x20f704[_0x5ae7('0x2a')]&&(_0x103b2b?_0x103b2b[_0x5ae7('0x24')](()=>_0x3c030b(_0x20f704[_0x5ae7('0x41')],_0x4bd6e3)):_0x20f704[_0x5ae7('0x40')][_0x5ae7('0x1c')](_0x58ca19=>{_0x58ca19[_0x5ae7('0x39')](_0x4bd6e3);}));}):_0x20f704[_0x5ae7('0x41')][_0x5ae7('0x43')][_0x5ae7('0x3')](_0x5ae7('0x2d'),()=>{_0x468ce2[_0x5ae7('0x11')]({'channelId':_0x586d32,'threadId':_0x1312b0,'target':()=>_0x3c030b(_0x20f704['editing'],_0x4bd6e3)});},{'priority':'low'});}}function $(_0x19346b,_0x51d56d){return _0x51d56d?_0x19346b+':'+_0x51d56d:_0x19346b;}function Q(_0x105995){const _0x1b34c9=_0x105995[_0x5ae7('0x27')](':');return{'group':_0x1b34c9[0x0],'id':_0x1b34c9[0x1]};}function U(_0x25e850,_0x56815a){const _0x342f3e=_0x56815a[_0x5ae7('0x48')],_0x30dd3f=_0x56815a[_0x5ae7('0x47')](_0x25e850['start']);for(const _0x5dbe9b of _0x25e850[_0x5ae7('0x1d')]()){const {type:_0x31a999,item:_0xff568c,nextPosition:_0x1905f2}=_0x5dbe9b;if(_0x5ae7('0x2')===_0x31a999||_0x342f3e[_0x5ae7('0x45')](_0xff568c)){const _0x3f3007=_0x56815a['createPositionBefore'](_0xff568c);_0x30dd3f[_0x5ae7('0x49')]&&(_0x30dd3f[_0x5ae7('0x7')]=_0x3f3007),_0x30dd3f[_0x5ae7('0x23')]=_0x1905f2;}}return _0x30dd3f['isCollapsed']?null:_0x30dd3f;}